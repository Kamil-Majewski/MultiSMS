@using Microsoft.AspNetCore.Identity
@using MultiSMS.Interface.Entities

@inject UserManager<Administrator> UserManager
@inject SignInManager<Administrator> SignInManager

@{
    var user = SignInManager.IsSignedIn(User) ? await UserManager.GetUserAsync(User) : null;
    var roles = user != null ? await UserManager.GetRolesAsync(user) : new List<string>();
    ViewData["Title"] = "MultiSMS";
}

@if (roles.Contains("Administrator") || roles.Contains("Owner"))
{
<div class="modal fade" id="deleteEntityModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="deleteEntityModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 550px; min-width: 307px; width:fit-content;">
        <div class="modal-content">
            <div class="modal-body">
                <span class="form-subtitle" id="modal-content-text"></span>
            </div>
            <div class="modal-footer">
                <button class="violet-button" id="confirmDelete" type="button" style="height:40px; background-color: #c95252;">Usuń kontakt</button>
                <button class="violet-button" id="denyDelete" type="button" style="margin-left:10px; height:40px;">Anuluj</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="viewReportModal" tabindex="-1" role="dialog" aria-labelledby="viewReportModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 500px; min-width: 307px; width:fit-content;">
        <div class="modal-content">
            <div class="modal-body">
                <span class="form-subtitle" id="import-modal-content-text"></span>
            </div>
            <div class="modal-footer" id="import-modal-footer">
                <button class="violet-button" id="viewReport" type="button" style="display:none; height:40px; margin-right:10px;">Otwórz szczegółowy raport</button>
                <button class="ie-button" id="closeModal" type="button" style="display:none; height:40px; margin-left:4px">OK</button>
            </div>
        </div>
    </div>
</div>
}

<div class="content-container">
    <div class="tab-content" id="category-tab-content">
        <div class="tab-pane show active" id="send-sms" aria-labelledby="sms-tab">
            <div class="alert alert-dismissible" id="status-message-sms" role="alert" style="border-radius: 50px; display:none;"></div>
            <div class="sms-container options-container">
                <div class="option-content">
                    <form class="sms-options-form options-form" id="send-sms-form">
                        <div class="row">
                            <div class="col">
                                <label for="GroupOfContacts">Grupa kontaktów</label>
                                <div style="width: 100%; display: inline-flex; justify-content: space-between;">
                                    <div style="display: flex; align-items: center; justify-content: space-between; position:relative; width: 100%;">
                                        <input type="text" class="form-input" id="GroupOfContacts" style="flex-grow:1; font-weight:500;" required disabled>
                                        <button type="button" class="btn-close text-dark input-icons" id="remove-group-selection-button" onclick="" aria-label="Close" style="width: 7px; height: 10px; top: 45%;"></button>
                                    </div>
                                    <button class="violet-button inline-button" id="choose-group-of-contacts" type="button" style="min-width: 125px; height: 44px; margin-left: 30px;" onclick="OpenChooseGroupForSMS()">Wybierz</button>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="ChosenTemplate">Szablon</label>
                                <div style="width: 100%; display: inline-flex; justify-content: space-between;">
                                    <div style="display: flex; align-items: center; justify-content: space-between; position:relative; width: 100%;">
                                        <input type="text" class="form-input" id="ChosenTemplate" style="flex-grow:1; font-weight:500;" disabled>
                                        <button type="button" class="btn-close text-dark input-icons" id="remove-template-selection-button" onclick="" aria-label="Close" style="width: 7px; height: 10px; top: 45%;"></button>
                                    </div>
                                    <button class="violet-button inline-button" id="choose-template" type="button" style="min-width: 125px; height: 44px; margin-left: 30px;" onclick="OpenChooseTemplateForSMS()">Wybierz</button>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col">
                                <label for="SmsText">Treść wiadomości *</label>
                                <textarea class="form-input" id="SmsText" rows="5" maxlength="160" required spellcheck="false"></textarea>
                                <div style="display: flex; justify-content:space-between;">
                                    <div>
                                        <a href="# more-options" class="bleak-hoverable options-hidden" style="margin-top: 0.20rem;">Więcej opcji</a>
                                    </div>
                                    <div class="symbol-counter" style="margin-top: 0.20rem; text-align: right" id="sms-text-symbol-counter">&nbsp</div>
                                </div>
                            </div>
                        </div>
                        <div class="more-options-container" style="display:none;">
                            <div class="row">
                                <div class="col">
                                    <label for="AdditionalPhoneNumbers" style="margin-top:10px">Dodatkowe numery telefonu</label>
                                    <input type="text" class="form-input" id="AdditionalPhoneNumbers" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <label for="Comment">Komentarz</label>
                                    <textarea class="form-input" id="Comment" rows="2" maxlength="100" style="margin-bottom:0px;"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="justify-content-center d-flex">
                            <button type="submit" class="violet-button" style="margin-top:20px;" id="SendSmsMessage">Wyślij wiadomość SMS</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="choose-group-for-sms-container list-container" style="display:none;">
                <div class="list-header">
                    <div class="previous-page" style="flex:1;">
                        <button class="violet-button" id="choose-group-for-sms-previous-button" type="button" style="display: flex; align-items:center;" onclick="GoBackToSMSWindow()">
                            <span class="arrow-back" style="max-width:24px;"><img src="~/icons/previous.png" /></span>
                            <span>Powrót</span>
                        </button>
                    </div>
                    <div class="option-name" style="flex:auto; text-align:center;">
                        <span class="opion-name-placeholder" id="choose-group-for-sms-title">Wybierz grupę odbiorców wiadomości</span>
                    </div>
                    <div class="list-search-bar">
                        <input class="search-for search-for-group-for-sms" placeholder="Wyszukaj grupę" style="flex:1;" />
                    </div>
                </div>
                <div class="list-content">
                    <div class="table-responsive">
                        <table class="choose-group-for-sms-list table table-borderless" id="choose-group-for-sms-table">
                            <thead>
                                <tr>
                                    <th class="small-cell">Nazwa</th>
                                    <th class="big-cell">Opis</th>
                                    <th class="tiny-centered-cell">Liczba członków</th>
                                    <th class="tiny-centered-cell">Akcja</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="choose-template-for-sms-container list-container" style="display:none;">
                <div class="list-header">
                    <div class="previous-page" style="flex:1;">
                        <button class="violet-button" id="choose-template-for-sms-previous-button" type="button" style="display: flex; align-items:center;" onclick="GoBackToSMSWindow()">
                            <span class="arrow-back" style="max-width:24px;"><img src="~/icons/previous.png" /></span>
                            <span>Powrót</span>
                        </button>
                    </div>
                    <div class="option-name" style="flex:auto; text-align:center;">
                        <span class="opion-name-placeholder" id="choose-template-for-sms-title">Wybierz szablon wiadomości</span>
                    </div>
                    <div class="list-search-bar">
                        <input class="search-for search-for-template-for-sms" placeholder="Wyszukaj szablon" style="flex:1;" />
                    </div>
                </div>
                <div class="list-content">
                    <div class="table-responsive">
                        <table class="choose-template-for-sms-list table table-borderless" id="choose-template-for-sms-table">
                            <thead>
                                <tr>
                                    <th scope="col">Nazwa</th>
                                    <th scope="col">Opis</th>
                                    <th scope="col">Treść</th>
                                    <th class="tiny-centered-cell">Opcje</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        @if (roles.Contains("Administrator") || roles.Contains("Owner"))
        {
            <div class="tab-pane" id="templates">
                <div class="templates-list-container list-container">
                    <div class="list-header">
                        <div class="list-header-left">
                            <button class="add-new-button violet-button" type="button" onclick="OpenCreateTemplateWindow()">Dodaj nowy</button>
                        </div>
                        <form class="list-search-bar d-flex" id="search-for-templates">
                            <input class="search-for template-search" placeholder="Wyszukaj szablon" />
                        </form>
                    </div>
                    <div class="list-content">
                        <div class="table-responsive">
                            <table class="template-list table table-borderless" id="template-table">
                                <thead>
                                    <tr>
                                        <th scope="col">Nazwa</th>
                                        <th scope="col">Opis</th>
                                        <th scope="col">Treść</th>
                                        <th class="centered-cell" scope="col">Opcje</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="list-footer" style="margin-top:15px; display:flex; align-items: center;">
                        <div style="flex:1;" id="template-previous-button-container">
                        </div>
                        <div class="page-counter" style="flex:auto; text-align:center;">
                            <span class="form-subtitle" id="template-page-counter" style="display:none;">0</span>
                        </div>
                        <div style="flex:1; display:flex; justify-content:right;" id="template-next-button-container">
                        </div>
                    </div>
                </div>
                <div class="templates-options-container options-container" style="display:none;">
                    <div class="option-content">
                        <div class="window-header">
                            <div class="left">
                                <a id="create-edit-template-go-back" onclick="GoBackToTemplateList()">
                                    <img src="/icons/back-arrow.png" class="arrow-back" title="Powrót">
                                </a>
                                <span>Tworzenie szablonu</span>
                            </div>
                        </div>
                        <form class="template-options-form options-form">
                            <div class="form-group">
                                <div class="row">
                                    <div class="col">
                                        <label for="templateNameInput">Nazwa szablonu *</label>
                                        <input type="text" class="form-input" id="templateNameInput" required maxlength="30" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="templateDescriptionInput">Opis</label>
                                        <input type="text" class="form-input" id="templateDescriptionInput" maxlength="50" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="templateContentInput">Treść wiadomości *</label>
                                        <textarea class="form-input" id="templateContentInput" rows="5" maxlength="160" required spellcheck="false"></textarea>
                                        <div class="symbol-counter" style="margin-top: 0.25rem; text-align: right" id="symbolCounterAdd">&nbsp</div>
                                    </div>
                                </div>
                            </div>
                            <div class="justify-content-center d-flex">
                                <button type="submit" class="violet-button violet-button-small" style="width: 50%" id="createOrEditButtonTemplates"></button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="templates-details-container options-container" style="display:none; ">
                    <div class="option-content" style="max-width:600px;">
                        <div class="window-header">
                            <div class="left">
                                <a id="templates-details-previous-button" onclick="GoBackToTemplateList()">
                                    <img src="/icons/back-arrow.png" class="arrow-back" title="Powrót">
                                </a>
                                <span>Szczegóły szablonu</span>
                            </div>
                        </div>
                        <div class="template-details-content-container" style="padding: 15px 30px 15px 30px;">
                            <span class="form-subtitle">Informacje</span>
                            <div class="row mb-10" style="margin-top: 20px;">
                                <div class="col d-flex">
                                    <label class="templates-details-label" for="TemplateId">Id:</label>
                                    <span class="details-span" id="TemplateId"></span>
                                </div>
                            </div>
                            <div class="row mb-10">
                                <div class="col d-flex">
                                    <label class="templates-details-label" for="TemplateName">Nazwa:</label>
                                    <span class="details-span" id="TemplateName"></span>
                                </div>
                            </div>
                            <div class="row mb-10">
                                <div class="col d-flex">
                                    <label class="templates-details-label" for="TemplateDescription">Opis:</label>
                                    <span class="details-span" id="TemplateDescription"></span>
                                </div>
                            </div>
                            <div class="row mb-10">
                                <div class="col d-flex">
                                    <label class="templates-details-label" for="TemplateContent">Treść:</label>
                                    <span class="details-span" id="TemplateContent"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="contacts">
                <div class="contacts-container">
                    <div class="contacts-list-container list-container">
                        <div class="list-header">
                            <div class="list-header-left">
                                <button class="add-new-button violet-button" type="button" onclick="OpenCreateContactWindow()">Dodaj nowy</button>
                                <input type="file" id="import-file-input" style="display: none;" accept=".csv" />
                                <button class="import-contacts-button ie-button" type="button" onclick="TriggerFileInput()">Importuj kontakty</button>
                                <button class="export-contacts-button ie-button" type="button" onclick="ExportContactsAndDownloadExcel()">Exportuj kontakty</button>
                            </div>
                            <form class="list-search-bar d-flex" id="search-for-contacts">
                                <input class="search-for contact-search" placeholder="Wyszukaj kontakt">
                            </form>
                        </div>
                        <div class="list-content">
                            <div class="table-responsive">
                                <table class="contacts-list table table-borderless" id="contacts-table">
                                    <thead>
                                        <tr>
                                            <th class="tiny-cell">Imię</th>
                                            <th class="tiny-cell" id="contact-surname">Nazwisko</th>
                                            <th class="tiny-cell">Email</th>
                                            <th class="small-cell" style="width: 150px;">Numer telefonu</th>
                                            <th class="tiny-centered-cell">Status</th>
                                            <th class="centered-cell">Grupy</th>
                                            <th class="centered-cell" scope="col">Opcje</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="list-footer" style="margin-top:15px; display:flex; align-items: center;">
                            <div style="flex:1;" id="contact-previous-button-container">
                            </div>
                            <div class="page-counter" style="flex:auto; text-align:center;">
                                <span class="form-subtitle" id="contact-page-counter" style="display:none;">0</span>
                            </div>
                            <div style="flex:1; display:flex; justify-content:right;" id="contact-next-button-container">
                            </div>
                        </div>
                    </div>
                    <div class="contacts-options-container options-container" style="margin: 20px; display: none;">
                        <div class="option-content">
                            <div class="window-header">
                                <div class="left">
                                    <a id="contact-create-edit-previous-button" onclick="GoBackToContactList()">
                                        <img src="/icons/back-arrow.png" class="arrow-back" title="Powrót">
                                    </a>
                                    <span>Tworzenie kontaktu</span>
                                </div>
                            </div>
                            <form class="contact-options-form options-form">
                                <div class="personal-data" style="margin-bottom:20px;">
                                    <span class="form-subtitle">Dane Personalne</span>
                                    <div class="form-group" style="margin-top: 20px;">
                                        <div class="row">
                                            <div class="col">
                                                <label for="contactNameInput">Imię *</label>
                                                <input type="text" class="form-input" id="contactNameInput" required maxlength="40">
                                            </div>
                                            <div class="col">
                                                <label for="contactSurnameInput">Nazwisko *</label>
                                                <input type="text" class="form-input" id="contactSurnameInput" required maxlength="40">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <label for="contactEmail">Email</label>
                                                <input type="email" class="form-input" id="contactEmail" maxlength="50">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <div class="contact-data" style="margin-top:20px; margin-bottom:20px;">
                                    <span class="form-subtitle">Dane Kontaktowe</span>
                                    <div class="form-group" style="margin-top:20px;">
                                        <div class="row">
                                            <div class="col">
                                                <label for="contactPhoneNumber">Numer telefonu *</label>
                                                <input type="tel" class="form-input" id="contactPhoneNumber" required maxlength="15" minlength="15" pattern="^\+[0-9]{2} \d{3} \d{3} \d{3}$">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <label for="contactHQAddress">Adres miejsca pracy</label>
                                                <input type="text" class="form-input" id="contactHQAddress" maxlength="50">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <label for="ContactPostalNumber" style="white-space: nowrap;">Kod pocztowy</label>
                                                <input type="text" class="form-input" id="ContactPostalNumber" pattern="[0-9]{2}-[0-9]{3}" maxlength="6">
                                            </div>
                                            <div class="col" style="flex-grow: 3;">
                                                <label for="ContactCity">Miasto</label>
                                                <input type="text" class="form-input" id="ContactCity" maxlength="30">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col" style="flex-grow:3;">
                                                <label for="contactDepartment">Jednostka organizacyjna</label>
                                                <input type="text" class="form-input" id="contactDepartment" maxlength="100">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <div class="other-data" style="margin-top: 20px;">
                                    <div class="form-group">
                                        <label for="contactIsActive" style="width:100%;">Czy kontakt obecnie jest zatrudniony?</label>
                                        <div class="form-check form-check-inline" style="margin-bottom: 8px;">
                                            <input class="check-input" type="radio" name="isActive?" id="isActiveYes" value="yes" checked />
                                            <label class="form-check-label" for="IsActiveYes">
                                                Tak
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="check-input" type="radio" name="isActive?" id="isActiveNo" value="no" />
                                            <label class="form-check-label" for="IsActiveNo">
                                                Nie
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="justify-content-center d-flex" style="margin-top: 20px;">
                                    <button type="submit" class="violet-button violet-button-small" id="createOrEditButtonContacts" style="width: 50%;"></button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="contacts-details-container options-container" style="margin: 20px; display: none;">
                        <div class="option-content" style="max-width: 600px;">
                            <div class="window-header">
                                <div class="left">
                                    <a id="contact-details-previous-button" onclick="GoBackToContactList()">
                                        <img src="/icons/back-arrow.png" class="arrow-back" title="Powrót">
                                    </a>
                                    <span>Szczegóły kontaktu</span>
                                </div>
                            </div>
                            <div class="contact-details-content-container" style="padding: 15px 30px 15px 30px;">
                                <div class="personal-data" style="margin-bottom:20px;">
                                    <span class="form-subtitle">Dane Personalne</span>
                                    <div class="form-group" style="margin-top: 20px;">
                                        <div class="row mb-10">
                                            <div class="col d-flex">
                                                <label class="contacts-detail-label" for="contactIdDetail">Id:</label>
                                                <span class="details-span" id="contactIdDetail"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-10">
                                            <div class="col d-flex">
                                                <label class="contacts-detail-label" for="contactNameDetail">Imię:</label>
                                                <span class="details-span" id="contactNameDetail"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-10">
                                            <div class="col d-flex">
                                                <label class="contacts-detail-label" for="contactSurnameDetail">Nazwisko:</label>
                                                <span class="details-span" id="contactSurnameDetail"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-10">
                                            <div class="col d-flex">
                                                <label class="contacts-detail-label" for="contactEmailDetail">Email:</label>
                                                <span class="details-span" id="contactEmailDetail"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <div class="contact-data" style="margin-top:20px; margin-bottom:20px;">
                                    <span class="form-subtitle">Dane Kontaktowe</span>
                                    <div class="form-group" style="margin-top:20px;">
                                        <div class="row mb-10">
                                            <div class="col d-flex">
                                                <label class="contacts-detail-label" for="contactPhoneNumberDetail">Numer telefonu:</label>
                                                <span class="details-span" id="contactPhoneNumberDetail"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-10">
                                            <div class="col d-flex">
                                                <label class="contacts-detail-label" for="contactHQAddressDetail">Adres miejsca pracy:</label>
                                                <span class="details-span" id="contactHQAddressDetail"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-10">
                                            <div class="col d-flex">
                                                <label class="contacts-detail-label" for="ContactPostalNumberDetail" style="white-space: nowrap;">Kod pocztowy:</label>
                                                <span class="details-span" id="ContactPostalNumberDetail"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-10">
                                            <div class="col d-flex">
                                                <label class="contacts-detail-label" for="ContactCityDetail">Miasto:</label>
                                                <span class="details-span" id="ContactCityDetail"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-10">
                                            <div class="col d-flex">
                                                <label class="contacts-detail-label" for="contactDepartmentDetail">Jednostka organizacyjna:</label>
                                                <span class="details-span" id="contactDepartmentDetail"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr />
                                <div class="other-data" style="margin-top: 20px;">
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="contacts-detail-label" for="contactGroupsDetail">Przypisane grupy:</label>
                                            <span class="details-span" id="contactGroupsDetail"></span>
                                        </div>
                                    </div>
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="contacts-detail-label" for="contactStatusDetail">Status:</label>
                                            <span class="details-span" id="contactStatusDetail"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="import-report-container list-container" style="display:none;">
                        <div class="list-header">
                            <div class="previous-page" style="flex:1;">
                                <button class="violet-button" id="contacts-previous-button" type="button" style="display: flex; align-items:center;" onclick="FinishBrowsingImportReport()">
                                    Zamknij raport
                                </button>
                            </div>
                            <div class="option-name" style="flex:auto; text-align:center;">
                                <span class="opion-name-placeholder" id="report-window-title">Importuj kontakty - raport</span>
                            </div>
                            <div style="flex:1;">
                                <div class="list-search-bar d-flex">
                                    <input class="search-for import-contact-search" placeholder="Wyszukaj kontakt">
                                </div>
                            </div>
                        </div>
                        <div class="list-content" style="margin-bottom:20px;" id="import-added-contacts-container">
                            <div class="table-responsive">
                                <table class="added-contacts-list table table-borderless" id="added-contacts-table" style="table-layout:fixed;">
                                    <thead>
                                        <tr>
                                            <th colspan="7" class="header" style="color:#5a6372c4; text-align: center; font-size: 18px; padding: 10px;">
                                                Kontakty dodane
                                            </th>
                                        </tr>
                                        <tr>
                                            <th class="tiny-cell">Imię</th>
                                            <th class="tiny-cell">Nazwisko</th>
                                            <th class="tiny-cell">Email</th>
                                            <th class="small-cell" style="width: 150px;">Numer telefonu</th>
                                            <th class="tiny-centered-cell">Status</th>
                                            <th class="tiny-centered-cell">Grupy przypisane</th>
                                            <th class="tiny-centered-cell">Grupy błędne (Id)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="list-content" style="margin-bottom:20px; margin-top:5px;" id="import-repeated-contacts-container">
                            <div class="table-responsive">
                                <table class="added-contacts-list table table-borderless" id="repeated-contacts-table" style="table-layout:fixed;">
                                    <thead>
                                        <tr>
                                            <th colspan="5" class="header" style="color:#5a6372c4; text-align: center; font-size: 18px; padding: 10px;">
                                                Kontakty powtórzone
                                            </th>
                                        </tr>
                                        <tr>
                                            <th class="tiny-cell">Imię</th>
                                            <th class="tiny-cell">Nazwisko</th>
                                            <th class="tiny-cell">Email</th>
                                            <th class="small-cell" style="width: 150px;">Numer telefonu</th>
                                            <th class="tiny-centered-cell">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="list-content" style="margin-bottom:20px; margin-top:5px;" id="import-invalid-contacts-container">
                            <div class="table-responsive">
                                <table class="added-contacts-list table table-borderless" id="invalid-contacts-table" style="table-layout:fixed;">
                                    <thead>
                                        <tr>
                                            <th colspan="5" class="header" style="color:#5a6372c4; text-align: center; font-size: 18px; padding: 10px;">
                                                Kontakty nieprawidłowe
                                            </th>
                                        </tr>
                                        <tr>
                                            <th class="tiny-cell">Imię</th>
                                            <th class="tiny-cell">Nazwisko</th>
                                            <th class="tiny-cell">Email</th>
                                            <th class="small-cell" style="width: 150px;">Numer telefonu</th>
                                            <th class="tiny-centered-cell">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="contact-options-container-assign list-container" style="display: none;">
                        <div class="list-header">
                            <div class="previous-page" style="flex:1;">
                                <button class="violet-button" id="contacts-assign-previous-button" type="button" style="display: flex; align-items:center;" onclick="GoBackToContactListFromAssign()">
                                    <span class="button-arrow-back" style="max-width:24px;"><img src="~/icons/previous.png" /></span>
                                    <span>Powrót</span>
                                </button>
                            </div>
                            <div class="option-name" style="flex:auto; text-align:center;">
                                <span class="opion-name-placeholder" id="contact-asssign-window-title">Zarządzaj grupami użytkownika</span>
                            </div>
                            <div style="flex:1;"></div>
                        </div>
                        <div class="list-content" style="margin-bottom: 24px;">
                            <div class="table-responsive">
                                <table class="group-assign-chosen-contact table table-borderless" id="group-assign-chosen-contact-table">
                                    <thead>
                                        <tr>
                                            <th class="tiny-cell">Imię</th>
                                            <th class="tiny-cell">Nazwisko</th>
                                            <th class="small-cell" style="width: 150px;">Numer telefonu</th>
                                            <th class="tiny-centered-cell">Status</th>
                                            <th class="centered-cell">Grupy</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="list-header">
                            <div></div>
                            <form class="list-search-bar d-flex" id="search-for-assign-groups">
                                <input class="search-for contact-search-for-group" placeholder="Wyszukaj grupę" />
                            </form>
                        </div>
                        <div class="list-content">
                            <div class="table-responsive" style="max-height: 39vh;">
                                <table class="group-assign-group-list table table-borderless" id="group-assign-group-list-table">
                                    <thead>
                                        <tr>
                                            <th class="small-cell">Nazwa</th>
                                            <th class="big-cell">Opis</th>
                                            <th class="tiny-centered-cell">Liczba członków</th>
                                            <th class="tiny-centered-cell" scope="col">Akcja</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="list-footer" style="margin-top:15px; display:flex; align-items: center;">
                            <div style="flex:1;" id="group-assign-previous-button-container">
                            </div>
                            <div class="page-counter" style="flex:auto; text-align:center;">
                                <span class="form-subtitle" id="group-assign-page-counter" style="display:none;">0</span>
                            </div>
                            <div style="flex:1; display:flex; justify-content:right;" id="group-assign-next-button-container">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="groups">
                <div class="groups-list-container list-container">
                    <div class="list-header">
                        <div class="list-header-left">
                            <button class="add-new-button violet-button" type="button" onclick="OpenCreateGroupWindow()">Dodaj nową</button>
                        </div>
                        <form class="list-search-bar d-flex" id="search-for-groups">
                            <input class="search-for group-search" placeholder="Wyszukaj grupę" />
                        </form>
                    </div>
                    <div class="list-content">
                        <div class="table-responsive">
                            <table class="group-list table table-borderless" id="group-table">
                                <thead>
                                    <tr>
                                        <th class="small-cell">Nazwa</th>
                                        <th class="big-cell">Opis</th>
                                        <th class="tiny-centered-cell">Liczba członków</th>
                                        <th class="centered-cell" scope="col">Opcje</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="list-footer" style="margin-top:15px; display:flex; align-items: center;">
                        <div style="flex:1;" id="group-previous-button-container">
                        </div>
                        <div class="page-counter" style="flex:auto; text-align:center;">
                            <span class="form-subtitle" id="group-page-counter" style="display:none;">0</span>
                        </div>
                        <div style="flex:1; display:flex; justify-content:right;" id="group-next-button-container">
                        </div>
                    </div>
                </div>
                <div class="groups-options-container options-container" style="display:none;">
                    <div class="option-content">
                        <div class="window-header">
                            <div class="left">
                                <a id="group-edit-create-previous-button" onclick="GoBackToGroupList()">
                                    <img src="/icons/back-arrow.png" class="arrow-back" title="Powrót">
                                </a>
                                <span>Tworzenie grupy</span>
                            </div>
                        </div>
                        <form class="group-options-form options-form">
                            <div class="form-group">
                                <div class="row">
                                    <div class="col">
                                        <label for="groupNameInput">Nazwa grupy *</label>
                                        <input type="text" class="form-input" id="groupNameInput" required maxlength="30" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="groupDescriptionInput">Opis grupy</label>
                                        <textarea class="form-input" id="groupDescriptionInput" rows="3" maxlength="100"></textarea>
                                        <div class="symbol-counter" style="margin-top: 0.25rem; text-align: right" id="symbolCounterAddGroups">&nbsp</div>
                                    </div>
                                </div>
                            </div>
                            <div class="justify-content-center d-flex">
                                <button type="submit" class="violet-button violet-button-small" id="createOrEditButtonGroups" style="width: 50%;"></button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="groups-options-container-assign list-container" style="display: none;">
                    <div class="list-header">
                        <div class="previous-page" style="flex:1;">
                            <button class="violet-button" id="groups-assign-previous-button" type="button" style="display: flex; align-items:center;" onclick="GoBackToGroupListFromAssign()">
                                <span class="button-arrow-back" style="max-width:24px;"><img src="~/icons/previous.png" /></span>
                                <span>Powrót</span>
                            </button>
                        </div>
                        <div class="option-name" style="flex:auto; text-align:center;">
                            <span class="opion-name-placeholder" id="group-asssign-window-title">Zarządzaj użytkownikami w grupie</span>
                        </div>
                        <div style="flex:1;"></div>
                    </div>
                    <div class="list-content" style="margin-bottom: 24px;">
                        <div class="table-responsive">
                            <table class="group-assign-chosen-group table table-borderless" id="group-assign-chosen-group-table">
                                <thead>
                                    <tr>
                                        <th class="small-cell">Nazwa</th>
                                        <th class="big-cell">Opis</th>
                                        <th class="tiny-centered-cell">Liczba członków</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="list-header">
                        <div></div>
                        <form class="list-search-bar d-flex" id="search-for-assingn-contacts">
                            <input class="search-for group-search-for-user" placeholder="Wyszukaj użytkownika" />
                        </form>
                    </div>
                    <div class="list-content">
                        <div class="table-responsive" style="max-height: 39vh;">
                            <table class="group-assign-contact-list table table-borderless" id="group-assign-contact-list-table">
                                <thead>
                                    <tr>
                                        <th class="tiny-cell">Imię</th>
                                        <th class="tiny-cell">Nazwisko</th>
                                        <th class="tiny-cell">Numer telefonu</th>
                                        <th class="tiny-centered-cell">Status</th>
                                        <th class="centered-cell">Grupy</th>
                                        <th class="tiny-centered-cell" style="width: 94px;">Akcja</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="list-footer" style="margin-top:15px; display:flex; align-items: center;">
                        <div style="flex:1;" id="contact-assign-previous-button-container">
                        </div>
                        <div class="page-counter" style="flex:auto; text-align:center;">
                            <span class="form-subtitle" id="contact-assign-page-counter" style="display:none;">0</span>
                        </div>
                        <div style="flex:1; display:flex; justify-content:right;" id="contact-assign-next-button-container">
                        </div>
                    </div>
                </div>
                <div class="groups-details-container options-container" style="margin: 20px; display:none;">
                    <div class="option-content" style="max-width: 600px;">
                        <div class="window-header">
                            <div class="left">
                                <a id="group-details-previous-button" onclick="GoBackToGroupList()">
                                    <img src="/icons/back-arrow.png" class="arrow-back" title="Powrót">
                                </a>
                                <span>Szczegóły grupy</span>
                            </div>
                        </div>
                        <div class="groups-details-content-container" style="padding: 10px 30px 30px 30px;">
                            <div class="group-data" style="margin-bottom:20px;">
                                <span class="form-subtitle">Informacje</span>
                                <div class="form-group" style="margin-top:20px;">
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="groups-detail-label" for="groupIdDetail">Id:</label>
                                            <span class="details-span" id="groupIdDetail"></span>
                                        </div>
                                    </div>
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="groups-detail-label" for="groupNameDetail">Nazwa grupy:</label>
                                            <span class="details-span" id="groupNameDetail"></span>
                                        </div>
                                    </div>
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="groups-detail-label" for="groupDescriptionDetail">Opis grupy:</label>
                                            <span class="details-span" id="groupDescriptionDetail"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr />
                            <div class="group-members-data" style="margin-top:20px;">
                                <span class="form-subtitle">Członkowie grupy</span>
                                <div class="form-group" style="margin-top:20px;">
                                    <div class="table-responsive" style="border: 2px solid #f0f1f1; max-height: 17em;">
                                        <table class="group-members-list table table-borderless" id="group-detail-members-table">
                                            <thead>
                                                <tr>
                                                    <th class="tiny-cell">Imię</th>
                                                    <th class="tiny-cell">Nazwisko</th>
                                                    <th class="small-cell" style="width: 150px;">Numer telefonu</th>
                                                    <th class="tiny-centered-cell">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="logs">
                <div class="logs-list-container list-container">
                    <div class="list-header">
                        <div class="list-header-left">
                        </div>
                        <form class="list-search-bar d-flex" id="search-for-logs">
                            <input class="search-for log-search" placeholder="Wyszukaj logi" />
                        </form>
                    </div>
                    <div class="list-content">
                        <div class="table-responsive">
                            <table class="log-list table table-borderless" id="log-table">
                                <thead>
                                    <tr>
                                        <th class="tiny-centered-cell">Typ</th>
                                        <th scope="col">Źródło</th>
                                        <th scope="col">Wiadomość</th>
                                        <th class="centered-cell" style="min-width:105px;">Data</th>
                                        <th class="tiny-centered-cell" scope="col">Opcje</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="list-footer" style="margin-top:15px; display:flex; align-items: center;">
                        <div style="flex:1;" id="log-previous-button-container">
                        </div>
                        <div class="page-counter" style="flex:auto; text-align:center;">
                            <span class="form-subtitle" id="log-page-counter" style="display:none;">0</span>
                        </div>
                        <div style="flex:1; display:flex; justify-content:right;" id="log-next-button-container">
                        </div>
                    </div>
                </div>
                <div class="logs-details-container options-container" style="margin: 20px; display:none;">
                    <div class="option-content" id="log-details-window" style="max-width: 600px;">
                        <div class="window-header">
                            <div class="left">
                                <a id="log-details-previous-button" onclick="GoBackToLogsList()">
                                    <img src="/icons/back-arrow.png" class="arrow-back" title="Powrót">
                                </a>
                                <span>Log</span>
                            </div>
                        </div>
                        <div class="logs-details-content-container" style="padding: 15px 30px 15px 30px;">
                            <div class="log-data" style="margin-bottom:20px;">
                                <span class="form-subtitle">Informacje</span>
                                <div class="form-group" style="margin-top:20px;">
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="logs-detail-label" for="logTypeDetail">Typ:</label>
                                            <span class="details-span" id="logTypeDetail"></span>
                                        </div>
                                    </div>
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="logs-detail-label" for="logSourceDetail">Źródło:</label>
                                            <span class="details-span" id="logSourceDetail"></span>
                                        </div>
                                    </div>
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="logs-detail-label" for="logMessageDetail">Wiadomość:</label>
                                            <span class="details-span" id="logMessageDetail"></span>
                                        </div>
                                    </div>
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="logs-detail-label" for="logCreationDateDetail">Data:</label>
                                            <span class="details-span" id="logCreationDateDetail"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr />
                            <div class="log-creator-data" style="margin-bottom:20px; margin-top: 4px;">
                                <span class="form-subtitle">Inicjator</span>
                                <div class="form-group" style="margin-top:20px;">
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="logs-detail-label" for="logCreatorNameDetail">Imię:</label>
                                            <span class="details-span" id="logCreatorNameDetail"></span>
                                        </div>
                                    </div>
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="logs-detail-label" for="logCreatorSurnameDetail">Nazwisko:</label>
                                            <span class="details-span" id="logCreatorSurnameDetail"></span>
                                        </div>
                                    </div>
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="logs-detail-label" for="logCreatorUsernameDetail">Email:</label>
                                            <span class="details-span" id="logCreatorUsernameDetail"></span>
                                        </div>
                                    </div>
                                    <div class="row mb-10">
                                        <div class="col d-flex">
                                            <label class="logs-detail-label" for="logCreatorPhoneNumberDetail">Numer telefonu:</label>
                                            <span class="details-span" id="logCreatorPhoneNumberDetail"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr />
                            <div class="log-related-objects-data" style="margin-top:20px;">
                                <div class="form-group" id="log-related-objects-data-form-group">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="users">
                <div class="users-container">
                    <div class="users-list-container list-container">
                        <div class="list-header">
                            <div class="list-header-left">
                                <button class="add-new-button violet-button" type="button" onclick="OpenCreateUserWindow()">Dodaj nowego</button>
                            </div>
                            <div>
                                <input class="search-for user-search" placeholder="Wyszukaj użytkownika">
                            </div>
                        </div>
                        <div class="list-content">
                            <div class="table-responsive">
                                <table class="users-list table table-borderless" id="users-table">
                                    <thead>
                                        <tr>
                                            <th class="tiny-cell">Imię</th>
                                            <th class="tiny-cell" id="user-surname">Nazwisko</th>
                                            <th class="tiny-cell">Email</th>
                                            <th class="small-cell" style="width: 150px;">Numer telefonu</th>
                                            <th class="centered-cell">Rola</th>
                                            <th class="centered-cell" scope="col">Opcje</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="users-options-container options-container" style="margin: 20px; display: none;">
                        <div class="option-content">
                            <div class="window-header">
                                <div class="left">
                                    <a id="user-edit-create-previous-button" onclick="GoBackToUserList()">
                                        <img src="/icons/back-arrow.png" class="arrow-back" title="Powrót">
                                    </a>
                                    <span>Tworzenie użytkownika</span>
                                </div>
                            </div>
                            <form class="user-options-form options-form">
                                <div class="role-data">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col">
                                                <label for="user-role">Rola*</label>
                                                <input type="text" class="form-input" id="user-role" name="Role" list="role-names" autocomplete="off" required="">
                                                <datalist id="role-names"><option value="User" selected="">Użytkownik</option></datalist>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="personal-data">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col">
                                                <label for="userNameInput">Imię*</label>
                                                <input type="text" class="form-input" id="userNameInput" name="Name" required maxlength="40">
                                            </div>
                                            <div class="col">
                                                <label for="userSurnameInput">Nazwisko*</label>
                                                <input type="text" class="form-input" id="userSurnameInput" name="Surname" required maxlength="40">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <label for="userEmail">Email*</label>
                                                <input type="email" class="form-input" id="userEmail" name="Email" maxlength="50">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="contact-data">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col">
                                                <label for="userPhoneNumber">Numer telefonu</label>
                                                <input type="tel" class="form-input" id="userPhoneNumber" name="PhoneNumber" required maxlength="15" minlength="15" pattern="^\+[0-9]{2} \d{3} \d{3} \d{3}$">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="login-data">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col">
                                                <label for="userPassword">Hasło jednorazowe*</label>
                                                <input type="password" class="form-input" id="userPassword" name="Password" required minlength="6" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="justify-content-center d-flex" style="margin-top: 20px;">
                                    <button type="submit" class="violet-button violet-button-small" id="createOrEditUserButton" style="width: 50%;">Utwórz użytkownika</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="settings">
                <div class="settings-options-password-container options-container" id="settings-password" style="height:320px; align-items: center;">
                <div class="option-content">
                    <form class="setting-options-password-form, options-form" id="settings-password-form" style="width: 100%; padding-top:30px;">
                        <span class="text-danger model-alert-font" id="authorization-failed-message" role='alert' style='display:block; padding:0;'></span>
                        <label class="form-subtitle" for="settings-password-input">Hasło</label>
                        <div class="password-input-container" id="enter-password-window" style="display: flex; justify-content: center; flex-direction:column; margin-bottom:25px;">
                            <input type="password" class="form-input" id="settings-password-input" aria-required="true" placeholder="Wprowadź hasło" required"/>
                            <img src="~/icons/closed-eye.png" class="input-icons" id="settings-eye-icon" alt="Toggle Password Visibility">
                        </div>
                        <div style="display:flex; justify-content:center; width:100%;">
                            <button id="settings-password-submit-button" type="submit" class="violet-button" style="width:50%; display:flex; justify-content:center; height:44px;">Autoryzuj</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="alert alert-dismissible" id="status-message-settings" role="alert" style="border-radius: 50px; display:none;"></div>
            <div class="settings-options-container options-container" id="settings-container" style="display:none; ">
                <div class="option-content">
                        <div class="window-header">
                            <div class="left">
                                <span>Ustawienia</span>
                            </div>
                        </div>
                    <form class="settings-options-form options-form" id="settings-form">
                    </form>
                </div>
            </div>
        </div>
        }
    </div>
</div>

<script defer>

    $(document).ready(function () {

        var passwordInput = document.getElementById("settings-password-input");
        var eyeIcon = document.getElementById("settings-eye-icon");

        togglePasswordVisibility(passwordInput, eyeIcon);
        showEyeIconOrResetPasswordField(passwordInput, eyeIcon);

        CalculateHeaderWidthAndToolbarHeight();
        PaginateTemplatesAndPopulateTable(null, 0, 11, true);
        PaginateContactsAndPopulateTable(null, 0, 11, true);
        PaginateGroupsAndPopulateTable(null, 0, 11, true);
        PaginateLogsAndPopulateTable(null, 0, 11, true);

        let resizeTimer;
        window.addEventListener('resize', () => {
            hoveredWidthInVW = (190 / $(window).width()) * 100;
            differenceInVW = hoveredWidthInVW - (50 / $(window).width()) * 100;
            document.body.classList.add("resize-animation-stopper");
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                document.body.classList.remove("resize-animation-stopper");
            }, 400);
            CalculateHeaderWidthAndToolbarHeight();

        });
        const elementToWatch = document.getElementById("settings-tab");

        if (elementToWatch != null) {

            const settingsClickedObserver = setupWatcher(elementToWatch, "active", () => {
                const tabChangedObserver = setupClassRemovalWatcher(elementToWatch, "active", () => {
                    $("#settings-form").empty();
                    $("#settings-container").hide();
                    $("#settings-password").show();
                    $("#status-message-settings").hide();
                    if ($("#settings-password-input").attr('type') == "text") {
                        $("#settings-eye-icon").click().hide();
                    }
                    else {
                        $("#settings-eye-icon").hide();
                    }
                    settingsClickedObserver.observe(elementToWatch, { attributes: true });
                });
                settingsClickedObserver.disconnect();
            });
        }

        const resizeObserver = new ResizeObserver(entries => {
            for (const entry of entries) {
                const { width, height } = entry.contentRect;
                CalculateHeaderWidthAndToolbarHeight();
            }
        });

        resizeObserver.observe($("#content-render")[0]);

        var initialToolboxContextWidthInPx = 50;
        var hoveredWidthInPx = 201;

        $(".option-list-item").hover(
            function () {
                $("#toolbar").css("width", hoveredWidthInPx + "px");
            },
            function () {
                $("#toolbar").css("width", initialToolboxContextWidthInPx + "px");
            }
        );

        var connection = null;

        $('#import-file-input').change(function () {
            $("#viewReportModal").modal("show");
            $("#import-modal-content-text").html(`
                <div class="progress" style="width: 450px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" id="import-contacts-progress-bar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%; transition: none;"></div>
                </div>
            `)
            if (!connection || connection.state !== signalR.HubConnectionState.Connected) {
                connection = new signalR.HubConnectionBuilder()
                    .withUrl("/progressHub")
                    .build();

                connection.on("ImportContactsProgress", (progress) => {
                    var intProgress = parseInt(progress);
                    $("#import-contacts-progress-bar").attr('aria-valuenow', intProgress);
                    $("#import-contacts-progress-bar").css('width', `${intProgress}%`);
                });

                connection.start()
                    .then(() => {
                        console.log("Connected to SignalR hub");
                        importContacts();
                    })
                    .catch((error) => {
                        console.log(error.responseText);
                    });
            }
            else {
                importContacts();
            }
        });

        $(document).on('change', "#select-active-api", function () {
            var apiName = $("#select-active-api").val();
            fetchApiSettingsByName(apiName);
        });

        $(document).on('click', '.template-delete', function (e) {
            e.preventDefault();
            var templateId = $(this).attr("href").split('-')[1];

            var name = $(this).closest('tr').find('.template-name').text();

            $("#modal-content-text").html(`Czy na pewno chcesz usunąć szablon ${name}?`);
            $("#confirmDelete").html("Usuń szablon");

            $('#deleteEntityModal').modal('show');

            $('#confirmDelete').on('click', function () {
                DeleteTemplate(templateId);

                $('#deleteEntityModal').modal('hide');
            });
            $('#denyDelete').on('click', function () {

                $('#deleteEntityModal').modal('hide');
            });
        });

        $(document).on('click', '.template-details', function (e) {
            e.preventDefault();
            var id = $(this).attr('href').split('-')[1];
            var name = $(this).closest('tr').find('.template-name').text();
            var description = $(this).closest('tr').find('.template-description').text();
            var content = $(this).closest('tr').find('.template-content').text();

            $("#TemplateId").text(id);
            $("#TemplateName").text(name);
            $("#TemplateDescription").text(description);
            $("#TemplateContent").text(content);
            $(".templates-list-container").hide();
            $(".templates-details-container").show();
        });

        $(document).on('click', '.group-details', function (e) {
            e.preventDefault();
            var id = $(this).attr('href').split('-')[1];
            var name = $(this).closest('tr').find('.group-name').text();
            var description = $(this).closest('tr').find('.group-description').text();

            $("#groupIdDetail").text(id);
            $("#groupNameDetail").text(name);
            $("#groupDescriptionDetail").text(description);

            $("#group-detail-members-table tbody").empty();

            $.ajax({
                url: '@Url.Action("GetAllEmployeesForGroup", "Home")',
                type: 'GET',
                contentType: 'application/json',
                data: { groupId: id },
                success: function (employeesList) {

                    $.each(employeesList, function (index, employee) {

                        var statusClass = employee.isActive ? 'active-pill' : 'inactive-pill';
                        var statusText = employee.isActive ? 'Aktywny' : 'Nieaktywny';

                        var newRow = `<tr>
                            <td class="tiny-cell">${employee.name}</td>
                            <td class="tiny-cell">${employee.surname}</td>
                            <td class="small-cell">${employee.phoneNumber}</td>
                            <td class="tiny-centered-cell"><span class="${statusClass}">${statusText}</span></td>
                            </tr>`

                        $("#group-detail-members-table tbody").append(newRow);
                    });

                    $(".groups-list-container").hide();
                    $(".groups-details-container").show();
                },
                error: function (error) {
                    console.error(error.responseText);
                }
            });
        });

        $(document).on('click', '#log-table tbody tr', function (e) {
            e.preventDefault();
            var id = $(this).find('a').first().attr('href').split('-')[1];

            $.ajax({
                url: '@Url.Action("GetLog", "Home")',
                type: 'GET',
                contentType: 'application/json',
                data: { logId: id },
                success: function (logEntity) {

                    $("#logTypeDetail").text(logEntity.log.logType);
                    $("#logSourceDetail").text(logEntity.log.logSource);
                    $("#logMessageDetail").text(logEntity.log.logMessage);
                    $("#logCreationDateDetail").text(new Date(logEntity.log.logCreationDate).toLocaleString('en-GB'));

                    $("#logCreatorNameDetail").text(logEntity.logCreator.name);
                    $("#logCreatorSurnameDetail").text(logEntity.logCreator.surname);
                    $("#logCreatorUsernameDetail").text(logEntity.logCreator.userName);
                    $("#logCreatorPhoneNumberDetail").text(logEntity.logCreator.phoneNumber || "Brak danych");


                    if (logEntity.type == "Template") {
                        HandleTemplateTypeLog(logEntity.template);
                    }
                    else if (logEntity.type == "Contact") {
                        HandleContactTypeLog(logEntity.contact);
                    }
                    else if (logEntity.type == "Groups-Assign") {
                        HandleGroupsAssignTypeLog({ group: logEntity.group, contact: logEntity.contact });
                    }
                    else if (logEntity.type == "Groups") {
                        HandleGroupsTypeLog(logEntity.group);
                    }
                    else if (logEntity.type == "SMS-ServerSms-Group" || logEntity.type == "SMS-SmsApi-Group") {
                        handleSMSGroupTypeLog({ apiUsed: logEntity.type.split("-")[1], sms: logEntity.sms, group: logEntity.group });
                    }
                    else if (logEntity.type == "SMS-ServerSms-NoGroup" || logEntity.type == "SMS-SmsApi-NoGroup") {
                        handleSMSNoGroupTypeLog({ apiUsed: logEntity.type.split("-")[1], sms: logEntity.sms });
                    }
                    else if (logEntity.type == "Import") {
                        handleImportTypeLog(logEntity.import);
                    }
                    else {
                        console.error("Unknown log type");
                    }

                    $(".logs-list-container").hide();
                    $(".logs-details-container").show();

                },
                error: function (error) {
                    console.error(error.responseText);
                }
            });
        });
        const debouncedPaginateTemplates = debounce(PaginateTemplatesAndPopulateTable, 220);

        $(document).on('click', '#templates-list-next-page-button', function () {
            var lastId = $("#template-table").attr('last-id');
            debouncedPaginateTemplates(null, lastId, 11, true);
        });

        $(document).on('click', '#templates-list-previous-page-button', function () {
            var firstId = $("#template-table").attr('first-id');
            debouncedPaginateTemplates(firstId, null, 11, false);
        });

        var debouncedPaginateContacts = debounce(PaginateContactsAndPopulateTable, 220);

        $(document).on('click', '#contacts-list-next-page-button', function () {
            var lastId = $("#contacts-table").attr('last-id');
            debouncedPaginateContacts(null, lastId, 11, true);
        });

        $(document).on('click', '#contacts-list-previous-page-button', function () {
            var firstId = $("#contacts-table").attr('first-id');
            debouncedPaginateContacts(firstId, null, 11, false);
        });

        var debouncedPaginateAssignContacts = debounce(PaginateAssignContactsAndPopulateTable, 220);

        $(document).on('click', '#contacts-assign-list-next-page-button', function () {
            var lastId = $("#group-assign-contact-list-table").attr('last-id');
            debouncedPaginateAssignContacts(null, lastId, 7, true);
        });

        $(document).on('click', '#contacts-assign-list-previous-page-button', function () {
            var firstId = $("#group-assign-contact-list-table").attr('first-id');
            debouncedPaginateAssignContacts(firstId, null, 7, false);
        });

        var debouncedPaginateGroups = debounce(PaginateGroupsAndPopulateTable, 220);

        $(document).on('click', '#groups-list-next-page-button', function () {
            var lastId = $("#group-table").attr('last-id');
            debouncedPaginateGroups(null, lastId, 11, true);
        });

        $(document).on('click', '#groups-list-previous-page-button', function () {
            var firstId = $("#group-table").attr('first-id');
            debouncedPaginateGroups(firstId, null, 11, false);
        });

        var debouncedPaginateLogs = debounce(PaginateLogsAndPopulateTable, 220);

        $(document).on('click', '#logs-list-next-page-button', function () {
            var lastId = $("#log-table").attr('last-id');
            debouncedPaginateLogs(null, lastId, 11, true);
        });

        $(document).on('click', '#logs-list-previous-page-button', function () {
            var firstId = $("#log-table").attr('first-id');
            debouncedPaginateLogs(firstId, null, 11, false);
        });

        var debouncedPaginateAssignGroupsToContact = debounce(PaginateAssignGroupsAndPopulateTable, 220);

        $(document).on('click', '#groups-assign-list-next-page-button', function () {
            var lastId = $("#group-assign-group-list-table").attr('last-id');
            debouncedPaginateAssignGroupsToContact(null, lastId, 7, true);
        });

        $(document).on('click', '#groups-assign-list-previous-page-button', function () {
            var firstId = $("#group-assign-group-list-table").attr('first-id');
            debouncedPaginateAssignGroupsToContact(firstId, null, 7, false);
        });
       
        $(document).on('click', '.options-hidden', function (e) {
            e.preventDefault();
            $(".options-hidden").text("Ukryj opcje");
            $(".more-options-container").slideDown(300);
            $(".options-hidden").addClass("options-shown");
            $(".options-hidden").removeClass("options-hidden");
        });

        var debouncedUnassignGroupFromUser = debounce(unassignGroupFromUser, 220);
        var debouncedAssingGroupToUser = debounce(assignGroupToUser, 220);

        $(document).on("click", "#group-assign-group-list-table tbody tr", function (e) {
            var link = $(this).find('a').first();
            var contactIdGroupId = link.attr("href").split('-');
            if (link.hasClass("contact-group-unassign")) {
                debouncedUnassignGroupFromUser(link, contactIdGroupId);
            }
            else {
                debouncedAssingGroupToUser(link, contactIdGroupId);
            }
        });

        $(document).on('click', '.options-shown', function (e) {
            e.preventDefault();
            $(".options-shown").text("Więcej opcji");
            $(".more-options-container").slideUp(300);
            $(".options-shown").addClass("options-hidden");
            $(".options-shown").removeClass("options-shown");

        });

        $(document).on('click', '.contact-details', function (e) {
            e.preventDefault();

            var id = $(this).attr('href').split('-')[1];

            $.ajax({
                url: '@Url.Action("GetContactById", "Home")',
                type: 'GET',
                contentType: 'application/json',
                data: { id: id },
                success: function (contactEntity) {

                    var email = contactEntity.email || "Brak danych";
                    var hqAddress = contactEntity.hqAddres || "Brak danych";
                    var postalNumber = contactEntity.postalNumber || "Brak danych";
                    var city = contactEntity.city || "Brak danych";
                    var department = contactEntity.department || "Brak danych";
                    var groupNames = contactEntity.employeeGroupNames;

                    $("#contactIdDetail").text(id);
                    $("#contactNameDetail").text(contactEntity.name);
                    $("#contactSurnameDetail").text(contactEntity.surname);
                    $("#contactEmailDetail").text(email);
                    $("#contactPhoneNumberDetail").text(contactEntity.phoneNumber);
                    $("#contactHQAddressDetail").text(hqAddress);
                    $("#ContactPostalNumberDetail").text(postalNumber);
                    $("#ContactCityDetail").text(city);
                    $("#contactDepartmentDetail").text(department);
                    $("#contactStatusDetail").text(contactEntity.isActive ? "Aktywny" : "Nieaktywny");
                    $("#contactGroupsDetail").text(groupNames.length == 0 ? "Nie przypisano" : groupNames.join(', '));

                    $("#contactStatusDetail").text() == "Aktywny" ? $("#contactStatusDetail").css('color', '#018707') : $("#contactStatusDetail").css('color', '#df3b15');

                    $(".contacts-list-container ").hide();
                    $(".contacts-details-container").show();

                },
                error: function (error) {
                    console.error(error.responseText);
                }
            });
        });

        $(document).on('click', '.contact-delete', function (e) {
            e.preventDefault();
            var name = $(this).closest('tr').find('.contact-name').text();
            var surname = $(this).closest('tr').find('.contact-surname').text();
            var contactId = $(this).attr("href").split('-')[1];

            $("#modal-content-text").html(`Czy na pewno chcesz usunąć kontakt ${name} ${surname}?`);

            $('#deleteEntityModal').modal('show');

            $('#confirmDelete').one('click', function () {
                DeleteContact(contactId);

                $('#deleteEntityModal').modal('hide');
            });
            $('#denyDelete').one('click', function () {

                $('#deleteEntityModal').modal('hide');
            });
        });

        $(document).on('hidden.bs.modal', '#deleteEntityModal', function () {
            $('#confirmDelete').off('click');
            $('#denyDelete').off('click');
        });

        $(document).on('hidden.bs.modal', '#viewReportModal', function () {
            $("#import-modal-content-text").text("Importowanie kontaktów w toku, proszę czekać...");
            $("#import-modal-footer").removeClass("justify-content-center");
            $("#viewReport").hide();
            $("#closeModal").hide();
            $('#viewReport').off('click');
            $('#closeModal').off('click');
        });

        $(document).on('click', '.group-delete', function (e) {
            e.preventDefault();
            var groupId = $(this).attr("href").split('-')[1];
            var name = $(this).closest('tr').find('.group-name').text();

            $("#modal-content-text").html(`Czy na pewno chcesz usunąć grupę ${name}?`);
            $("#confirmDelete").html("Usuń grupę");

            $('#deleteEntityModal').modal('show');

            $('#confirmDelete').one('click', function () {
                DeleteGroup(groupId);

                $('#deleteEntityModal').modal('hide');
            });
            $('#denyDelete').one('click', function () {

                $('#deleteEntityModal').modal('hide');
            });
        });

        $(document).on('click', '.template-edit', function (e) {
            e.preventDefault();
            var templateId = $(this).attr("href").split('-')[1];
            var name = $(this).closest('tr').find('.template-name').text();
            var description = $(this).closest('tr').find('.template-description').text();
            var content = $(this).closest('tr').find('.template-content').text();

            if (description == "Brak opisu") {
                description = "";
            }

            $("#createOrEditButtonTemplates").attr("data-id", templateId)

            $("#templateNameInput").val(name);
            $("#templateDescriptionInput").val(description);
            $("#templateContentInput").val(content);
            const messageEle = document.getElementById('templateContentInput');
            document.getElementById('symbolCounterAdd').innerHTML = messageEle.value.length + "/" + messageEle.getAttribute('maxlength');

            $(".templates-options-container .left span").html("Edycja szablonu");
            $(".template-options-form").attr('id', 'edit-template-form');
            $("#createOrEditButtonTemplates").html("Zatwierdź edycję");
            $(".templates-list-container").hide();
            $(".templates-options-container").show();
        });

        $(document).on('click', '.contact-edit', function (e) {
            e.preventDefault();
            var contactId = $(this).attr("href").split('-')[1];

            $.ajax({
                url: '@Url.Action("GetContactById", "Home")',
                type: 'GET',
                data: { id: contactId },

                contentType: 'application/json',
                success: function (contactEnitity) {

                    if (contactEnitity.isActive == false) {
                        document.querySelector('input[name="isActive?"]:checked').checked = false;
                        document.getElementById("isActiveNo").checked = true;
                    }

                    $("#createOrEditButtonContacts").attr("data-id", contactEnitity.employeeId)
                    $("#contactNameInput").val(contactEnitity.name);
                    $("#contactSurnameInput").val(contactEnitity.surname);
                    $("#contactEmail").val(contactEnitity.email);
                    $("#contactPhoneNumber").val(contactEnitity.phoneNumber);
                    $("#contactHQAddress").val(contactEnitity.hqAddress);
                    $("#ContactPostalNumber").val(contactEnitity.postalNumber);
                    $("#ContactCity").val(contactEnitity.city);
                    $("#contactDepartment").val(contactEnitity.department);
                    contactEnitity.isActive ? $("#isActiveYes").prop("checked", true).trigger("click") : $("#isActiveNo").prop("checked", true).trigger("click");

                    $(".contacts-options-container .left span").html("Edycja kontaktu")
                    $(".contact-options-form").attr('id', 'edit-contact-form');
                    $("#createOrEditButtonContacts").html("Zatwierdź edycję");
                    $(".contacts-options-container").show();
                    $(".contacts-list-container").hide();
                },
                error: function (error) {
                    console.error(error.responseText);
                }
            });
        });

        $(document).on('click', '.group-edit', function (e) {
            e.preventDefault();
            var groupId = $(this).attr("href").split('-')[1];
            var name = $(this).closest('tr').find('.group-name').text();
            var description = $(this).closest('tr').find('.group-description').text();

            if (description == "Brak opisu") {
                description = "";
            }

            $("#createOrEditButtonGroups").attr("data-id", groupId)
            $("#groupNameInput").val(name);
            $("#groupDescriptionInput").val(description);
            const messageEle = document.getElementById('groupDescriptionInput');
            document.getElementById('symbolCounterAddGroups').innerHTML = messageEle.value.length + "/" + messageEle.getAttribute('maxlength');

            $(".groups-options-container .left span").html("Edycja grupy")
            $(".group-options-form").attr('id', 'edit-group-form');
            $("#createOrEditButtonGroups").html("Zatwierdź edycję");
            $(".groups-list-container").hide();
            $(".groups-options-container").show();

        });

        $(document).on('click', '.group-assign', function (e) {
            e.preventDefault();
            var groupId = $(this).attr("href").split('-')[1];
            PopulateTablesForAssigningUsersToGroups(groupId)
        });

        $(document).on('click', '.contact-assign-groups', function (e) {
            e.preventDefault();
            var contactId = $(this).attr("href").split('-')[1];
            PopulateTablesForAssigningGroupsToUsers(contactId)
        });

        $(document).on('click', '#choose-group-for-sms-table tbody tr', function (e) {
            e.preventDefault();
            var groupId = $(this).find("a").first().attr("href").split('-')[1];

            $.ajax({
                url: '@Url.Action("GetGroupById", "Home")',
                type: 'GET',
                data: { id: groupId },

                contentType: 'application/json',
                success: function (groupEntity) {
                    $("#remove-group-selection-button").show();
                    $("#GroupOfContacts").val(groupEntity.groupName);
                    $("#GroupOfContacts").attr('data-id', groupEntity.groupId);
                },
                error: function (error) {
                    console.error(error.responseText);
                }
            });
            GoBackToSMSWindow();
        });

        $(document).on('click', "#remove-group-selection-button", function (e) {
            $("#GroupOfContacts").val("");
            $("#GroupOfContacts").removeAttr('data-id');
            $(this).hide();
        });

        $(document).on('click', "#remove-template-selection-button", function (e) {
            $("#ChosenTemplate").val("");
            $("#SmsText").val("");
            $(this).hide();

            const messageEle = document.getElementById('SmsText');
            document.getElementById('sms-text-symbol-counter').innerHTML = messageEle.value.length + "/" + messageEle.getAttribute('maxlength');
        });

        $(document).on('click', '#choose-template-for-sms-table tbody tr', function (e) {
            e.preventDefault();
            var templateId = $(this).find("a").first().attr("href").split('-')[1];

            $.ajax({
                url: '@Url.Action("GetTemplateById", "Home")',
                type: 'GET',
                data: { id: templateId },

                contentType: 'application/json',
                success: function (templateEntity) {
                    $("#remove-template-selection-button").show();
                    $("#ChosenTemplate").val(templateEntity.templateName);
                    $("#ChosenTemplate").attr('data-id', templateEntity.groupId);
                    $("#SmsText").val(templateEntity.templateContent);

                    const messageEle = document.getElementById('SmsText');
                    document.getElementById('sms-text-symbol-counter').innerHTML = messageEle.value.length + "/" + messageEle.getAttribute('maxlength');
                },
                error: function (error) {
                    console.error(error.responseText);
                }
            });
            GoBackToSMSWindow();
        });

        var debouncedAddUserToGroup = debounce(addUserToGroup, 220);
        var debouncedRemoveUserFromGroup = debounce(removeUserFromGroup, 220);

        $(document).on("click", "#group-assign-contact-list-table tbody tr", function (e) {
            e.preventDefault();

            var link = $(this).find('a').first();
            var contactIdGroupId = link.attr("href").split("-");
            if (link.hasClass("contact-assign")) {
                debouncedAddUserToGroup(link, contactIdGroupId)
                groupAssignMembersIds.push(parseInt(contactIdGroupId[1]));
            }
            else {
                debouncedRemoveUserFromGroup(link, contactIdGroupId);
                var contactIdInt = parseInt(contactIdGroupId[1]);
                var indexOfContactId = groupAssignMembersIds.indexOf(contactIdInt);
                groupAssignMembersIds.splice(indexOfContactId, 1);
            }
        });

        $(document).on('submit', '#create-template-form', function (e) {
            var form = document.getElementById("create-template-form");
            e.preventDefault();

            if (form.checkValidity() === false) {
                form.reportValidity()
                return
            }

            CreateNewTemplate();
            GoBackToTemplateList();
            $(".template-options-form :input").val('');

        });

        $(document).on('submit', "#settings-password-form", function (e) {
            var form = document.getElementById("settings-password-form");
            e.preventDefault();

            if(form.checkValidity() == false){
                form.reportValidity()
                return
            }
            
            var password = $("#settings-password-input").val();
            checkIfAuthorizationSuccessful(password);
        });

        $(document).on('submit', "#settings-form", function (e) {
            $("#status-message-settings").hide();
            $("#status-message-settings").removeClass("success-status");
            $("#status-message-settings").removeClass("failed-status");
            var form = document.getElementById("settings-form");
            e.preventDefault();

            if (form.checkValidity() == false) {
                form.reportValidity()
                return
            }

            updateApiSettings();
        });

        $(document).on('submit', '#create-contact-form', function (e) {
            var form = document.getElementById("create-contact-form");
            e.preventDefault();

            if (form.checkValidity() === false) {
                form.reportValidity()
                return
            }

            CreateNewContact();
            GoBackToContactList();

        });

        $(document).on('submit', '#create-group-form', function (e) {
            var form = document.getElementById("create-group-form");
            e.preventDefault();

            if (form.checkValidity() === false) {
                form.reportValidity()
                return
            }

            CreateNewGroup();
            GoBackToGroupList();
            $(".group-options-form :input").val('');

        });

        $(document).on('submit', '#edit-template-form', function (e) {
            var form = document.getElementById("edit-template-form");
            e.preventDefault();

            if (form.checkValidity() === false) {
                form.reportValidity()
                return
            }

            EditTemplate();
            GoBackToTemplateList();

        });

        $(document).on('submit', '#send-sms-form', function (e) {
            $("#status-message-sms").hide();
            $("#status-message-sms").removeClass("failed-status");
            $("#status-message-sms").removeClass("success-status");

            var form = document.getElementById("send-sms-form");
            e.preventDefault();

            if (form.checkValidity() === false) {
                form.reportValidity()
                return
            }

            var smsText = $("#SmsText").val();
            var smsGroupId = $("#GroupOfContacts").attr("data-id");
            var smsGroupName = $("#GroupOfContacts").val();
            var additionalPhoneNumbers = $("#AdditionalPhoneNumbers").val().replace(/[^0-9+,]/g, '');
            var smsAdditionalInfo = $("#Comment").val();

            var phoneLastSymbol = additionalPhoneNumbers.charAt(additionalPhoneNumbers.length - 1);
            if (phoneLastSymbol == " ") {
                additionalPhoneNumbers = additionalPhoneNumbers.slice(0, -2);
            }
            else if (phoneLastSymbol == ",") {
                additionalPhoneNumbers = additionalPhoneNumbers.slice(0, -1);
            }

            SendSMS(smsText, smsGroupId, smsGroupName, additionalPhoneNumbers, smsAdditionalInfo);
        });


        $(document).on('submit', '#edit-contact-form', function (e) {
            var form = document.getElementById("edit-contact-form");
            e.preventDefault();

            if (form.checkValidity() === false) {
                form.reportValidity()
                return
            }

            EditContact();
            GoBackToContactList();

        });

        $(document).on('submit', '#edit-group-form', function (e) {
            var form = document.getElementById("edit-group-form");
            e.preventDefault();

            if (form.checkValidity() === false) {
                form.reportValidity()
                return
            }

            EditGroup();
            GoBackToGroupList();

        });

        OnSubmitFilterTemplatesTable("#search-for-templates", ".template-search", "#template-table")

        OnSubmitFilterContactsTable("#search-for-contacts", ".contact-search", "#contacts-table")

        OnInputFilterTable(".search-for-group-for-sms", "#choose-group-for-sms-table");

        OnInputFilterTable(".search-for-template-for-sms", "#choose-template-for-sms-table");

        OnSubmitFilterGroupsTable("#search-for-groups", ".group-search", "#group-table");

        OnSubmitFilterAssignContactsTable("#search-for-assingn-contacts", ".group-search-for-user", "#group-assign-contact-list-table");

        OnSubmitFilterAssignGroupsTable("#search-for-assign-groups", ".contact-search-for-group", "#group-assign-group-list-table");

        OnSubmitFilterLogsTable("#search-for-logs", ".log-search", "#log-table");

        OnInputFilterTable(".import-contact-search", "#added-contacts-table");

        OnInputFilterTable(".import-contact-search", "#repeated-contacts-table");

        OnInputFilterTable(".import-contact-search", "#invalid-contacts-table");


        $("#ContactPostalNumber").on('input', function () {

            if (event.inputType === 'deleteContentBackward' || event.inputType === 'deleteContentForward') {
                return;
            }

            var inputValue = $(this).val();
            var cursorPosition = this.selectionStart;

            var sanitizedValue = inputValue.replace(/[^0-9]/g, '');

            var formattedValue = sanitizedValue.replace(/(\S{2})/, '$1-');
            var lengthDiff = formattedValue.length - inputValue.length;

            $(this).val(formattedValue);

            this.setSelectionRange(cursorPosition + lengthDiff, cursorPosition + lengthDiff);


        });

        $("#contactPhoneNumber").on('input', function () {
            var phoneInput = document.getElementById('contactPhoneNumber');

            if (event.inputType === 'deleteContentBackward' || event.inputType === 'deleteContentForward') {
                return;
            }

            var inputValue = phoneInput.value;
            var cursorPosition = phoneInput.selectionStart;

            var sanitizedValue = inputValue.replace(/[^0-9+]/g, '');

            var formattedValue = sanitizedValue.replace(/(\S{3})/g, '$1 ').trim();
            var lengthDiff = formattedValue.length - inputValue.length;

            phoneInput.value = formattedValue;

            phoneInput.setSelectionRange(cursorPosition + lengthDiff, cursorPosition + lengthDiff);
        });

        $("#AdditionalPhoneNumbers").on('input', function () {
            var phoneInput = document.getElementById('AdditionalPhoneNumbers');

            if (event.inputType === 'deleteContentBackward' || event.inputType === 'deleteContentForward') {
                return;
            }

            var inputValue = phoneInput.value;
            var cursorPosition = phoneInput.selectionStart;

            var sanitizedValue = inputValue.replace(/[^0-9+,]/g, '');

            var formattedValue = sanitizedValue.replace(/(\S{3})(?!,)/g, '$1 ').trim();

            var inputtedSymbol = inputValue.charAt(inputValue.length - 1);

            if (inputtedSymbol == ",") {
                formattedValue = formattedValue.slice(0, -1);
            }
            else if (formattedValue.replace(/[,\s]/g, "").length % 12 == 0 && formattedValue.length > 0 && /[^0-9]/.test(inputtedSymbol) !== true) {
                formattedValue += ", ";
            }

            var lengthDiff = formattedValue.length - inputValue.length;

            phoneInput.value = formattedValue;

            phoneInput.setSelectionRange(cursorPosition + lengthDiff, cursorPosition + lengthDiff);
        });

        $("#templateContentInput").on('input', function (e) {
            const counterEle = document.getElementById('symbolCounterAdd');

            SanitizePolishSymbols("templateContentInput");

            const target = e.target;
            const maxLength = target.getAttribute('maxlength');
            const currentLength = target.value.length;

            counterEle.innerHTML = `${currentLength}/${maxLength}`;
        });

        $("#SmsText").on('input', function (e) {
            const counterEle = document.getElementById('sms-text-symbol-counter');

            SanitizePolishSymbols("SmsText");

            const target = e.target;
            const maxLength = target.getAttribute('maxlength');
            const currentLength = target.value.length;

            counterEle.innerHTML = `${currentLength}/${maxLength}`;
        });

        $(document).on('input', "#contactEmail", function () {
            SanitizePolishSymbols("contactEmail");
        });

        $("#groupDescriptionInput").on('input', function (e) {
            const counterEle = document.getElementById('symbolCounterAddGroups');

            const target = e.target;
            const maxLength = target.getAttribute('maxlength');
            const currentLength = target.value.length;

            counterEle.innerHTML = `${currentLength}/${maxLength}`;
        });
    });


</script>
